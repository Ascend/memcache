include(ExternalProject)
set(THIRD_PARTY_DIR ${PROJECT_SOURCE_DIR}/3rdparty)
SET(THIRD_PARTY_BINARY_DIR ${PROJECT_BINARY_DIR}/3rdparty)
set(INSTALL_DIR ${PROJECT_3RDPARTY_BIN_DIR}/spdlog)
set(THIRD_PARTY_CMAKE_ARGS
        -DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}
        -DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}
        -DCMAKE_C_FLAGS=${CMAKE_C_FLAGS}
        -DCMAKE_C_FLAGS_RELEASE=${CMAKE_C_FLAGS_RELEASE}
        -DCMAKE_C_FLAGS_DEBUG=${CMAKE_C_FLAGS_DEBUG}
        -DCMAKE_CXX_FLAGS=${CMAKE_CXX_FLAGS}
        -DCMAKE_CXX_FLAGS_RELEASE=${CMAKE_CXX_FLAGS_RELEASE}
        -DCMAKE_CXX_FLAGS_DEBUG=${CMAKE_CXX_FLAGS_DEBUG}
        -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
        -DCMAKE_INSTALL_LIBDIR=${INSTALL_DIR}/lib
        -DCMAKE_INSTALL_BINDIR=${INSTALL_DIR}/bin
        -DCMAKE_INSTALL_PREFIX=${INSTALL_DIR}/)
message(STATUS "THIRD_PARTY_CMAKE_ARGS:")
message(STATUS ${THIRD_PARTY_CMAKE_ARGS})
######################################################################
# Spdlog
######################################################################
SET(SPDLOG_CMAKE_ARGS
        ${THIRD_PARTY_CMAKE_ARGS}
        -DBUILD_SHARED_LIBS=OFF)

EXTERNALPROJECT_ADD(spdlog
        URL ${PROJECT_3RDPARTY_SRC_DIR}/log/spdlog
        SOURCE_DIR ${PROJECT_3RDPARTY_SRC_DIR}/log/spdlog
        CMAKE_ARGS ${SPDLOG_CMAKE_ARGS}
        BUILD_ALWAYS OFF
        DOWNLOAD_COMMAND ""
        LOG_DOWNLOAD On
        LOG_CONFIGURE On
        LOG_BUILD On
        LOG_INSTALL On)

EXTERNALPROJECT_GET_PROPERTY(spdlog SOURCE_DIR)
EXTERNALPROJECT_GET_PROPERTY(spdlog BINARY_DIR)
SET(SPDLOG_LIBS_DIR ${BINARY_DIR} CACHE PATH ${PROJECT_SOURCE_DIR})
SET(SPDLOG_INCLUDE_DIR ${SOURCE_DIR}/include CACHE PATH ${PROJECT_SOURCE_DIR})
MACRO(TARGET_SPDLOG target)
    ADD_DEPENDENCIES(${target} spdlog)
    TARGET_INCLUDE_DIRECTORIES(${target} PUBLIC ${SPDLOG_INCLUDE_DIR})
    IF(${CMAKE_BUILD_TYPE} STREQUAL "DEBUG")
        TARGET_LINK_LIBRARIES(${target} PUBLIC -L${SPDLOG_LIBS_DIR} libspdlogd.a pthread)
    ELSE()
        TARGET_LINK_LIBRARIES(${target} PUBLIC -L${SPDLOG_LIBS_DIR} libspdlog.a pthread)
    ENDIF()
ENDMACRO()

MACRO(TARGET_SPDLOG_HEADER_ONLY target)
    ADD_DEPENDENCIES(${target} spdlog)
    TARGET_INCLUDE_DIRECTORIES(${target} PUBLIC ${SPDLOG_INCLUDE_DIR})
ENDMACRO()